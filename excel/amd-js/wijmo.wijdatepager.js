var wijmo;define(["globalize","./wijmo.widget","./wijmo.wijpopup"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){"use strict";var r=jQuery,i="wijdatepager",s="wijmo-wijdatepager",o="wijmo-wijdatepager-increment",u="wijmo-wijdatepager-decrement",a="wijmo-wijdatepager-container",f="wijmo-wijdatepager-pages",l="wijmo-wijdatepager-pagelabel",c="wijmo-wijdatepager-pagelabel-first",h="wijmo-wijdatepager-pagelabel-last",p="wijmo-wijdatepager-pageheader",d="wijmo-wijdatepager-pagerange",v="wijmo-wijdatepager-tooltip",m="wijmo-wijdatepager-tooltip-inner",g="wijmo-wijdatepager-triangle",y="wijmo-wijdatepager-width-smallest",b="wijmo-wijdatepager-width-small",w="wijmo-wijdatepager-width-medium",E="wijmo-wijdatepager-width-normal",S=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype._setOption=function(e,n){var r=this.options.selectedDate,i=function(e,t){return e&&t&&e.getTime&&t.getTime?e.getTime()===t.getTime():e===t};t.prototype._setOption.call(this,e,n);switch(e){case"culture":case"cultureCalendar":this.options[e]=n,this._innerCulture=null,this._resetCulture(),this._initBackground();break;case"selectedDate":this.options.selectedDate=n,this._initBackground(),i(n,r)||this._onSelectedDateChanged();break;case"viewType":this.options.viewType=n,this._initBackground();break;case"nextTooltip":this.element.find("."+o).attr("title",n);break;case"prevTooltip":this.element.find("."+u).attr("title",n);break;case"firstDayOfWeek":this.options.firstDayOfWeek=n,this.options.viewType==="week"&&this._initBackground()}return this},n.prototype._innerDisable=function(){t.prototype._innerDisable.call(this),this._toggleDisableDatePager(!0)},n.prototype._innerEnable=function(){t.prototype._innerEnable.call(this),this._toggleDisableDatePager(!1)},n.prototype._toggleDisableDatePager=function(e){this.element.toggleClass(this.options.wijCSS.stateDisabled,e),r.mobile==null?(this.element.find("."+u).button("option","disabled",e),this.element.find("."+o).button("option","disabled",e)):(this.element.find("."+u).toggleClass(this.options.wijCSS.stateDisabled,e),this.element.find("."+o).toggleClass(this.options.wijCSS.stateDisabled,e))},n.prototype._create=function(){var e=this.options,n,i,l;window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r)),e.selectedDate||(e.selectedDate=new Date),this._nativeClass=this.element.attr("class"),this._dtpagernamespacekey="dtpager"+(new Date).getTime(),this.element.addClass(s).addClass(e.wijCSS.wijdatepager).addClass(e.wijCSS.widget).addClass(e.wijCSS.helperClearFix),n=r.proxy(this.invalidate,this),r(window).bind("resize."+this._dtpagernamespacekey,n),this.element.disableSelection&&this.element.disableSelection(),this.element.append(r("<a></a>").addClass(u).addClass(e.wijCSS.wijdatepagerDecButton).append(r("<span>"+e.prevTooltip+"</span>"))).append(r("<div></div>").addClass(a).addClass(e.wijCSS.wijdatepagerContainer).addClass(e.wijCSS.content).append(r("<div></div>").addClass(f).addClass(e.wijCSS.wijdatepagerPages))).append(r("<a></a>").addClass(o).addClass(e.wijCSS.wijdatepagerIncButton).append(r("<span>"+e.nextTooltip+"</span>"))),i=this.element.find("."+u),l=this.element.find("."+o),r.mobile==null?(i.button({icons:{primary:e.wijCSS.iconArrowLeft},text:!1}),l.button({icons:{primary:e.wijCSS.iconArrowRight},text:!1})):(i.html(""),i.addClass(e.wijCSS.iconArrowLeft+" "+e.wijCSS.icon+" ui-btn"),l.html(""),l.addClass(e.wijCSS.iconArrowRight+" "+e.wijCSS.icon+" ui-btn")),i.click(r.proxy(this.goLeft,this)),l.click(r.proxy(this.goRight,this)),this._initBackground(),t.prototype._create.call(this)},n.prototype.destroy=function(){var e=this.options.wijCSS;this.element.empty().removeAttr("aria-disabled"),this.element.attr("class",this._nativeClass?this._nativeClass:""),r(window).unbind("."+this._dtpagernamespacekey),r(document).unbind("."+this._dtpagernamespacekey),t.prototype.destroy.call(this)},n.prototype.refresh=function(){this.invalidate()},n.prototype.invalidate=function(){var e,t=this.options,n=t.selectedDate,i,s=this.element.find("."+a),c=this.element.find("."+u),h=this.element.find("."+o),p=this.element.innerWidth(),d=c.is(":visible")?c.outerWidth(!0):0,v=h.is(":visible")?h.outerWidth(!0):0,m,g,S,x,T;e=this.element.find("."+l+"."+this._getDateClass(n)),e.length!==1?e=r(this.element.find("."+l)[this._index]):(i=this.element.find("."+l).index(e),this._index=i),T="."+l,x=t.wijCSS.stateActive.split(" "),r.each(x,function(e){T+="."+x[e]}),this.element.find(T).removeClass(t.wijCSS.stateActive),e.addClass(this.options.wijCSS.stateActive),s.css("left",d),this.element.removeClass(y).removeClass(t.wijCSS.wijdatepagerWidthSmallest).removeClass(b).removeClass(t.wijCSS.wijdatepagerWidthSmall).removeClass(w).removeClass(t.wijCSS.wijdatepagerWidthMedium).removeClass(E).removeClass(t.wijCSS.wijdatepagerWidthNormal),p<300?this.element.addClass(y).addClass(t.wijCSS.wijdatepagerWidthSmallest):p<475?this.element.addClass(b).addClass(t.wijCSS.wijdatepagerWidthSmall):p<600?this.element.addClass(w).addClass(t.wijCSS.wijdatepagerWidthMedium):this.element.addClass(E).addClass(t.wijCSS.wijdatepagerWidthNormal),s.outerWidth(p-d-v),r.browser.msie&&parseInt(r.browser.version,10)<=7&&(m=this.element.find("."+f),g=m.find("."+l),S=Math.round(m.width()/this._datesDef.length)-(g.outerWidth(!0)-g.width()),g.width(S))},n.prototype.goLeft=function(e){if(this._isDisabled())return;this._setSelectedIndex(this._index-1,!0);if(e)return e.preventDefault(),!1},n.prototype.goRight=function(){if(this._isDisabled())return;this._setSelectedIndex(this._index+1)},n.prototype._getCulture=function(e){return this._innerCulture||this._resetCulture(e),this._innerCulture},n.prototype._resetCulture=function(e){var t=r.wijGetCulture(e||this.options.culture,this.options.cultureCalendar);this._innerCulture=t},n.prototype._isRTL=function(){return!!this._getCulture().isRTL},n.prototype._initBackground=function(e,t){var n=this;typeof e=="undefined"&&(e=!1),typeof t=="undefined"&&(t=!1);var i,s,o,u,a,v=this,m=v.options,g,y=r("<div></div>");if(this._isInAnimate)return;this._index=0,this._datesDef=this._getDatesDefinition(),this._min=0,this._max=this._datesDef.length-1,r.each(this._datesDef,function(e,t){var i=r("<div>"+n._datesDef[e].l+"</div>").addClass(l).addClass(m.wijCSS.wijdatepagerPageLabel).addClass(n._getDateClass(t.d));e===0&&i.addClass(c).addClass(m.wijCSS.wijdatepagerPageLabelFirst),t.range&&i.addClass(d).addClass(m.wijCSS.wijdatepagerPageRange),t.header&&i.addClass(p).addClass(m.wijCSS.wijdatepagerPageHeader).addClass(m.wijCSS.stateHighlight),e===n._max&&i.addClass(h).addClass(m.wijCSS.wijdatepagerPageLabelLast),y.append(i)}),i=y.html(),o=this.element.find("."+f),e?(this._isInAnimate=!0,s=o.clone(!0),o.html(i),u=o.find("."+l),t?(s.insertAfter(o),a=r(u[this._index]).offset().left,o.css("opacity",0).css("left",-s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.css("left",0).stop().animate({left:s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),v._isInAnimate=!1,v.invalidate()})):(s.insertBefore(o),a=r(u[this._index]).offset().left,o.css("opacity",0).css("left",s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.stop().animate({left:"-"+s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),v._isInAnimate=!1,v.invalidate()}))):(o.html(i),this.invalidate()),u=o.find("."+l),u.hover(r.proxy(this._pagelabelHover,this),r.proxy(this._pagelabelHout,this)),u.bind("mousedown",r.proxy(this._pagelabelMouseDown,this)),u.click(r.proxy(function(e){var t=r(e.target),n;n=this.element.find("."+l).index(t),this._setSelectedIndex(n)},this))},n.prototype._getDateClass=function(e){return"c1dt"+e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate()},n.prototype._addDays=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+t)},n.prototype._getDatesDefinition=function(){var e=this.options,t=e.viewType.toLowerCase(),n,r,i,s,o,u=[],a=e.selectedDate;switch(t){case"week":i=new Date(a.getFullYear(),a.getMonth(),-6),n=e.firstDayOfWeek-i.getDay(),Math.abs(n)>6&&(n=i.getDay()-e.firstDayOfWeek),i=this._addDays(i,n),o=new Date(a.getFullYear(),a.getMonth()+1,7),n=0;while(i<=o||i.getMonth()===a.getMonth())s=this._addDays(i,7),u.push({l:this._formatString(this.localizeString("weekViewLabelFormat","{0:MMM dd}-{1:dd}"),i,this._addDays(i,6)),d:i,d2:this._addDays(i,6)}),a>=i&&a<=s&&(this._index=n),i=s,n+=1;break;case"month":r=new Date(a.getFullYear()-1,0,1),u.push({l:this._formatString(this.localizeString("monthViewYearLabelFormat","{0:yyyy}"),r),d:r,range:!0}),r=new Date(a.getFullYear(),0,1),u.push({l:this._formatString(this.localizeString("monthViewYearLabelFormat","{0:yyyy}"),r),d:r,header:!0});for(n=0;n<12;n+=1)r=new Date(a.getFullYear(),n,1),u.push({l:this._formatString(this.localizeString("monthViewLabelFormat","{0:MMM}"),r),d:r}),s=new Date(a.getFullYear(),n+1,1),a>=r&&a<=s&&(this._index=n+2);r=new Date(a.getFullYear()+1,0,1),u.push({l:this._formatString(this.localizeString("monthViewYearLabelFormat","{0:yyyy}"),r),d:r,range:!0});break;default:r=new Date(a.getFullYear(),a.getMonth(),0),u.push({l:this._formatString(this.localizeString("dayViewMonthLabelFormat","{0:MMM}"),r),d:r,range:!0}),r=new Date(a.getFullYear(),a.getMonth(),1),u.push({l:this._formatString(this.localizeString("dayViewMonthLabelFormat","{0:MMM}"),r),d:r,header:!0}),i=r,n=2;while(i.getMonth()===a.getMonth())s=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1),u.push({l:this._formatString(this.localizeString("dayViewLabelFormat","{0:d }"),i),d:i}),a>=i&&a<=s&&(this._index=n),i=s,n+=1;r=new Date(a.getFullYear(),a.getMonth()+1,1),u.push({l:this._formatString(this.localizeString("dayViewMonthLabelFormat","{0:MMM}"),r),d:r,range:!0})}return u},n.prototype._setSelectedIndex=function(e,t){typeof t=="undefined"&&(t=!1);var n=this.options,r;if(this._isDisabled())return;if(e>=this._min&&e<=this._max){this._dragActivated&&this._showTooltip(e);if(this._index!==e){if(this._datesDef[e].header){if(!t)return;e-=1}this._index=e,r=this._datesDef[e].d,n.selectedDate=r,this._max>2&&this._index===0?this._initBackground(!0,!0):this._index===this._max?(n.viewType==="week"&&(n.selectedDate=new Date(n.selectedDate.getFullYear(),n.selectedDate.getMonth(),n.selectedDate.getDate()+7)),this._initBackground(!0,!1),n.selectedDate=r):this.invalidate(),this._onSelectedDateChanged()}}},n.prototype._onSelectedDateChanged=function(){var e=this.options;this._trigger("selectedDateChanged",null,{selectedDate:e.selectedDate})},n.prototype._pagelabelHover=function(e){var t=r(e.target),n=this.options;if(t.hasClass(p))return;t.addClass(n.wijCSS.stateHover)},n.prototype._showTooltip=function(e){var t=this.options,n=this._datesDef[e],i=t.viewType,s,o=this.element.find("."+l)[e];this._tooltip||(this._tooltip=r("<div></div>").addClass(v).addClass(t.wijCSS.wijdatepagerTooltip).append(r("<div></div>").addClass(m).addClass(t.wijCSS.wijdatepagerTooltipInner)).append(r("<div></div>").addClass(g).addClass(t.wijCSS.wijdatepagerTriangle)),this.element.append(this._tooltip),this._tooltip.wijpopup()),s="";switch(i){case"week":n.d.getMonth()!==n.d2.getMonth()?s=this._formatString(this.localizeString("weekViewTooltip2MonthesFormat","{0:MMMM d} - {1:MMMM d, yyyy}"),n.d,n.d2):s=this._formatString(this.localizeString("weekViewTooltipFormat","{0:MMMM d} - {1:d, yyyy}"),n.d,n.d2);break;case"month":s=this._formatString(this.localizeString("monthViewTooltipFormat","{0:MMMM yyyy}"),n.d);break;default:s=this._formatString(this.localizeString("dayViewTooltipFormat","{0:dddd, MMMM d, yyyy}"),n.d)}r.ui&&(this._tooltip.wijpopup("show",{of:o,my:"center bottom",at:"center top",offset:"-10 -10"}),this._tooltip.find("."+m).html(s))},n.prototype._hideTooltip=function(){this._tooltip.wijpopup("hide")},n.prototype._pagelabelHout=function(e){r(e.target).removeClass(this.options.wijCSS.stateHover)},n.prototype._pagelabelMouseDown=function(e){this._dragActivated=!1;if(this._isDisabled())return;e.preventDefault();var t=r(e.target),n;if(t.hasClass(p))return;n=this.element.find("."+l).index(t),this._dragActivated=!0,this._setSelectedIndex(n),this._mouseDownTimeFix20555=(new Date).getTime(),this._startClientX=e.pageX,this._startInd=n,r(document).bind("mousemove."+this._dtpagernamespacekey,r.proxy(this._pageindicatorMouseMove,this)),r(document).bind("mouseup."+this._dtpagernamespacekey,r.proxy(this._pageindicatorMouseUp,this))},n.prototype._detectLeftButton=function(e){return e.originalEvent&&(e=e.originalEvent),"buttons"in e?e.buttons===1:"which"in e?e.which===1:e.button===1},n.prototype._pageindicatorMouseMove=function(e){if(!this._detectLeftButton(e)){this._pageindicatorMouseUp();return}e.preventDefault();if(this._isInAnimate)return;var t=this.element.find("."+l)[this._startInd],n,r;if(!t)return;n=t.offsetLeft+Math.round(t.offsetWidth/2)+(e.pageX-this._startClientX),r=this._findClosesPageIndexByPos(n);if(this._prevMoveInd===r)return;this._prevMoveInd=r;if(this._mouseDownTimeFix20555+150>(new Date).getTime())return;r!==-1&&r!==this._index&&this._setSelectedIndex(r)},n.prototype._pageindicatorMouseUp=function(){this._dragActivated=!1,r(document).unbind("."+this._dtpagernamespacekey),this._hideTooltip()},n.prototype._findClosesPageIndexByPos=function(e){var t=this.element.find("."+f).find("."+l),n;for(n=0;n<t.length;n+=1)if(t[n].offsetLeft<e&&t[n].offsetLeft+t[n].offsetWidth>e)return n;return-1},n.prototype.localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},n.prototype._formatString=function(e,t,n,r){var i,s=arguments,o,u,a=this;if(s.length<=1)return Globalize.format(s);typeof e=="string"&&typeof window[e]=="function"&&(e=window[e]);if(typeof e=="function"){u=[];for(o=1;o<s.length;o+=1)u[o-1]=s[o];return e.apply(this,u)}return i=new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}","g"),e.replace(i,function(e,t,n,r,i){return e=s[Number(t)+1],r?Globalize.format(e,r,a._getCulture()):e})},n}(t.wijmoWidget);n.wijdatepager=S;var x=function(){function e(){this.wijCSS={wijdatepager:"",wijdatepagerIncButton:"",wijdatepagerDecButton:"",wijdatepagerContainer:"",wijdatepagerPages:"",wijdatepagerPageLabel:"",wijdatepagerPageLabelFirst:"",wijdatepagerPageLabelLast:"",wijdatepagerPageHeader:"",wijdatepagerPageRange:"",wijdatepagerTooltip:"",wijdatepagerTooltipInner:"",wijdatepagerTriangle:"",wijdatepagerWidthSmallest:"",wijdatepagerWidthSmall:"",wijdatepagerWidthMedium:"",wijdatepagerWidthNormal:""},this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body ui-body-b",stateDefault:"ui-btn ui-btn-b"},this.initSelector=":jqmData(role='wijdatepager')",this.culture="",this.cultureCalendar="",this.localization=null,this.firstDayOfWeek=0,this.selectedDate=null,this.viewType="day",this.nextTooltip="right",this.prevTooltip="left",this.selectedDateChanged=null}return e}();S.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new x),r.wijmo.registerWidget(i,S.prototype)})(t.datepager||(t.datepager={}));var n=t.datepager})(wijmo||(wijmo={}))});